{% extends "base/base.html" %} {% block content %}
<div class="card shadow">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0"><i class="fas fa-folder mr-2"></i>Documents</h4>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead class="thead-light">
          <tr>
            <th scope="col">Title</th>
            <th scope="col">Status</th>
            <th scope="col">Created At</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for doc in documents %}
          <tr>
            <td>
              {% if doc.status == 'DRAFT' and doc.created_by == user %}
              <a
                href="{% url 'workflow:document-edit' doc.id %}"
                class="text-primary"
              >
                <i class="fas fa-file-alt mr-1"></i>{{ doc.title }}
              </a>
              {% else %}
              <i class="fas fa-file-alt mr-1 text-muted"></i>{{ doc.title }} 
              {% endif %}
            </td>
            <td>
              {% if doc.status == 'DRAFT' %}
              <span class="badge badge-secondary"
                >{{ doc.get_status_display }}</span
              >
              {% elif doc.status == 'PENDING' %}
              <span class="badge badge-warning"
                >{{ doc.get_status_display }}</span
              >
              {% elif doc.status == 'APPROVED' %}
              <span class="badge badge-success"
                >{{ doc.get_status_display }}</span
              >
              {% elif doc.status == 'REJECTED' %}
              <span class="badge badge-danger"
                >{{ doc.get_status_display }}</span
              >
              {% endif %}
            </td>
            <td>{{ doc.created_at }}</td>
            <td>
              <div class="btn-group" role="group">
                <!-- View -->
                <a
                  href="{% url 'workflow:document-detail' doc.id %}"
                  class="btn btn-sm btn-outline-primary"
                >
                  <i class="fas fa-eye mr-1"></i>View
                </a>

                <!-- Submit (Owner Draft Only) -->
                {% if doc.status == 'DRAFT' and doc.created_by == user %}
                <form
                  method="post"
                  action="{% url 'workflow:document-submit' doc.id %}"
                  class="d-inline ml-1"
                >
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-success">
                    <i class="fas fa-paper-plane mr-1"></i>Submit
                  </button>
                </form>
                {% endif %}

                <!-- Audit (Admin Only) -->
                {% if is_admin %}
                <a
                  href="{% url 'workflow:document-audit-log' doc.id %}"
                  class="btn btn-sm btn-info ml-1"
                >
                  <i class="fas fa-history mr-1"></i>Audit
                </a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="text-center text-muted">
              <i class="fas fa-inbox fa-2x mb-2"></i><br />
              No documents found.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-3">
      <a href="{% url 'workflow:document-create' %}" class="btn btn-primary">
        <i class="fas fa-plus-circle mr-1"></i>Create New Document
      </a>
    </div>
  </div>
</div>
{% endblock %}
